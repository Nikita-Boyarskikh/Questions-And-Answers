my @lines = <>;
my %vars;
foreach (@lines) {
    if(/\s*\#(\w+)\=\'(.*)\'\#/) {
        $vars{$1} = $2;  # Собираем все переменные из файла в хэш
    }
}

# Заменяем переменные, если при подстановке использовались значения других переменных
$vars{$_} =~ s/\#(\w+)\#/$vars{$1}/g foreach (keys %vars);

# Заменяем имена на значения переменных в файле
s/\#(\w+)\#/$vars{$1}/g foreach (@lines);
print join "", @lines;
